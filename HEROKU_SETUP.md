# Heroku Deployment Setup Guide

## Проблема: Connection refused to localhost

Если вы видите ошибку подключения к localhost, это означает, что:
1. PostgreSQL аддон не добавлен на Heroku
2. Или DATABASE_URL не установлен

## Решение (БЕЗ Heroku CLI - через веб-интерфейс):

### Шаг 1: Добавить PostgreSQL аддон через веб-интерфейс

1. Зайдите на https://dashboard.heroku.com
2. Войдите в свой аккаунт
3. Выберите ваше приложение
4. Перейдите в раздел **"Resources"** (вкладка вверху)
5. В поле "Add-ons" введите: `Heroku Postgres`
6. Нажмите на результат поиска
7. Выберите план **"Mini"** (бесплатный) или **"Essential"**
8. Нажмите **"Submit Order Form"**

После этого Heroku автоматически:
- Добавит PostgreSQL базу данных
- Установит переменную окружения `DATABASE_URL`
- Перезапустит приложение

### Шаг 2: Настроить базу данных через веб-консоль

1. На странице вашего приложения на Heroku
2. Нажмите на кнопку **"More"** (справа вверху) → **"Run console"**
3. Выберите **"bash"**
4. В открывшейся консоли выполните:

```bash
# Сначала проверим, что DATABASE_URL установлен
echo $DATABASE_URL

# Затем создадим таблицы
psql $DATABASE_URL -f schema.sql

# И вставим данные
psql $DATABASE_URL -f insert_data.sql
```

**ВАЖНО:** Файлы `schema.sql` и `insert_data.sql` должны быть в репозитории на GitHub, чтобы их можно было использовать.

### Альтернативный способ: Через SQL команды напрямую

Если файлы недоступны, можно скопировать SQL команды:

1. Откройте `schema.sql` на вашем компьютере
2. Скопируйте все содержимое
3. В веб-консоли Heroku выполните:
   ```bash
   psql $DATABASE_URL
   ```
4. Вставьте скопированные SQL команды
5. Нажмите Enter
6. Выйдите командой: `\q`

Повторите то же самое для `insert_data.sql`

## Решение (С Heroku CLI):

Если хотите установить Heroku CLI:

### Установка Heroku CLI:

**Linux:**
```bash
curl https://cli-assets.heroku.com/install.sh | sh
```

**Или через snap:**
```bash
sudo snap install heroku --classic
```

**Или через пакетный менеджер:**
```bash
# Ubuntu/Debian
sudo apt-get install heroku

# Или скачайте с https://devcenter.heroku.com/articles/heroku-cli
```

После установки:
```bash
heroku login
heroku addons:create heroku-postgresql:mini
```

### Шаг 3: Проверить, что все работает

1. Откройте ваше приложение в браузере (ссылка вида: `https://your-app-name.herokuapp.com`)
2. Проверьте, что нет ошибок подключения к базе данных
3. Попробуйте создать пользователя или просмотреть список пользователей

### Шаг 4: Проверить логи (если есть проблемы)

1. На странице приложения на Heroku
2. Перейдите в раздел **"More"** → **"View logs"**
3. Ищите ошибки подключения к базе данных

## Проверка через веб-интерфейс:

1. На странице приложения → **"Settings"**
2. Прокрутите до **"Config Vars"**
3. Должна быть переменная **`DATABASE_URL`** со значением типа `postgres://...`

## Если все еще не работает:

1. Убедитесь, что PostgreSQL аддон добавлен (Resources → должен быть "Heroku Postgres")
2. Убедитесь, что таблицы созданы (попробуйте открыть Users в приложении)
3. Проверьте логи на наличие ошибок
4. Убедитесь, что последний код задеплоен (Settings → увидите последний commit)

